@{
    ViewData["Title"] = "Admin";
}

<head>
     <link rel="stylesheet" href="/css/custom.css" />

    <link href="https://fonts.googleapis.com/css?family=McLaren|Montserrat&display=swap" rel="stylesheet">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

</head>

<body id="mainTable" class="container">
    <div class="tab" id="marg">
        <h3 id="admintable">Events</h3>
        <a href="/event/eventaddition" id="newevent" class="btn btn-info">Create Event</a>
    </div>
    <p>
        <table id ="table" style="width:100%">
            <tr>
                <th>Event Type</th>
                <th>Date/Time</th>
                <th>Duration</th>
                <th>Description</th>
                <th></th>
            </tr>
            <tbody>
            </tbody>
        </table>
    </p>
    <script>
        $(document).ready(function () {
            $.ajax({
            type: 'get',
            dataType: "json",
            url: 'https://localhost:5001/event/all',
                success: function (results) {
                    for (var a = 0; a < results.length; a++) {

                        var i = results[a];

                        var type = i['eventName'];
                        var time = i['eventDateTime'];
                        var dur = (i['eventDuration']);
                        var desc = i['eventDescription'];
                        var event_id = i['eventId'];
                        console.log(event_id);

                        modalDivs(event_id, a);


                        var feed = `<button type="button" class="btn btn-primary" data-toggle="modal" data-target="#modal${a}"> Delete Event </button>`;
                        var toAppend = '<tr><td>' + type + '</td><td>' + time + '</td><td>' + dur + ' hours</td><td>' + desc + '</td><td>' + feed + '</td></tr>';

                        $('#table').append(toAppend);

                    }

                    function modalDivs(event_id, a) {

                        var name, buttons = requesters(event_id, a)
                        var tableBody = $(`<tbody id="tbody${a}"></tbody>`).append(name, buttons);

                        var tableHead = $('<tr></tr>').append('<th>Name</th><th>Approve</th>');
                        var table = $('<table></table>').append(tableHead, tableBody);
                        var modalBody = $('<div class="modal-body"></div>').append(table);

                        var modalTitle = $('<h4 class="modal-title"></h4>').text("Volunteers");
                        var times = $('<span aria-hidden="true"></span>').append('&times;');
                        var closeButton = $('<button type="button" class="close" data-dismiss="modal" aria-label="Close"></button>').append(times);
                        var modalHeader = $('<div class="modal-header"></div>').append(modalTitle, closeButton);

                        var modalContent = $('<div class="modal-content"></div>').append(modalHeader, modalBody);
                        var modalDialog = $(`<div class="modal-dialog modal-lg"></div>`).append(modalContent);
                        var modal = $(`<div id="modal${a}" class="modal fade"></div>`).append(modalDialog);

                        $('#mainTable').before(modal);
                    }


                    function requesters(event_id, a) {
                        $.ajax({
                            type: 'get',
                            dataType: 'json',
                            url: 'https://localhost:5001/event/eventrequests/' + event_id,
                            success: function (results) {
                                for (i = 0; i < results.length; i++) {
                                    modalBodyTable(results[i]['eventRequesterId'], a)
                  
                                }

                            }
                        });
                    }

                    function modalBodyTable(requesterID, a) {
                        $.ajax({
                            type: 'get',
                            dataType: 'json',
                            url: 'https://localhost:5001/user/' + requesterID,
                            success: function (results) {

                                var name = results['firstName'] + ' ' + results['lastName'];
                                var trow = $('<tr></tr>').append('<td>' + name + `</td><td><button id="Accept_button${a}" type="button" class="bt btn-info">Accept</button></td>`);
                                
                                $(`#tbody${a}`).append(trow);

                            }
                        });
                        
                    }
                }
            });

            //$.ajax({
            //    type: 'get',
            //    dataType: "json",
            //    url: "https://localhost:5001/event/all",
            //    success: function (results) {
            //        for (var a = 0; a < results.length; a++){

            //            var i = results[a];

            //            var type = i['eventName'];
            //            var ti = i['eventDateTime'];
            //            var regex = new RegExp('/([0-9]|0[0-9]|1[0-9])/([0 - 9][0 - 9] | [0 - 9]) / [0 - 9]{ 4} at ([0 - 9] | 0[0 - 9] | 1[0 - 9]): [0 - 9]{ 2 }: [0 - 9]{ 2 } (AM | PM)/g');
            //            var date = ti.split(regex);
            //            var dur = (i['eventDuration']);
            //            var desc = i['eventDescription'];
            //            var event_id = i['eventId'];

            //            $('#table').append('<tr><td><button type="button" class="btn btn-info" data-toggle="modal" data-target="#myModal"></button><td>' + type + '</td><td>' + date + '</td><td>' + dur + 'hrs' + '</td><td>' + desc + '</td><td><a href="/event/eventaddition" id="newevent" class="btn btn-info">Delete Event</a></td></tr>');
            //            eventRequest(event_id);

            //        }
            //    }
            //});

            //function eventRequest(event_id) {
            //    $.ajax({
            //    type: 'get',
            //    dataType: "json",
            //    url: "https://localhost:5001/event/eventrequests/" + event_id,
            //        success: function (results) {
            //            for (var a = 0; a < results.length; a++) {
            //                var i = results[a];
            //                var user_id = i['eventRequesterId'];
            //                var date = (i['eventRequestDate']);
            //                var eventResponseFK = i['eventRequestId'];

            //                var name = getUser(user_id);
            //                console.log(name);

                            

            //                //var first = user['firstName'];
            //                //console.log('test');
            //                //var last = user['lastName'];

            //                $('#atable').append('<tr><td>' + name + '</td><td>' + date + `</td><td><button id="Accept_button${a}" type="button" class="bt btn-info">Accept</button></td><td><button type="button" class="btn btn-info">` + 'Deny' + '</button></td></tr>');
            //            }
            //        }
            //    });
            ////            responseStatus: True,
        });

    </script>
</body>
